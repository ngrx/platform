# V21 Update Guide

## Angular CLI update

NgRx supports using the Angular CLI `ng update` command to update your dependencies. Migration schematics are run to make the upgrade smoother. These schematics will fix some of the breaking changes.

To update your packages to the latest released version, run the command below.

```sh
ng update @ngrx/store@21
```

## Dependencies

Version 21 has the minimum version requirements:

- Angular version 21
- Angular CLI version 21
- TypeScript version 5.9
- RxJS version ^6.5.x || ^7.5.0

## Breaking changes

### @ngrx/signals

#### `withEffects` is renamed to `withEventHandlers`

The `withEffects` feature from the `@ngrx/signals/events` plugin is renamed to `withEventHandlers`.

BEFORE:

```ts
import { withEffects } from '@ngrx/signals/events';

export const CounterStore = signalStore(
  withState({ count: 0 }),
  withEffects((store, events = inject(Events)) => ({
    logCount$: events
      .on(increment)
      .pipe(tap(() => console.log(store.count()))),
  }))
);
```

AFTER:

```ts
import { withEventHandlers } from '@ngrx/signals/events';

export const CounterStore = signalStore(
  withState({ count: 0 }),
  withEventHandlers((store, events = inject(Events)) => ({
    logCount$: events
      .on(increment)
      .pipe(tap(() => console.log(store.count()))),
  }))
);
```

#### `rxMethod` and `signalMethod` accept computation functions as arguments

`rxMethod` and `signalMethod` provide the ability to pass computation functions as input arguments in addition to signals.
Because of that, defining callbacks as direct inputs needs be handled differently.

BEFORE:

```ts
// rxMethod:
const myRxMethod = rxMethod<() => void>(
  tap((callback) => callback())
);

myRxMethod(() => console.log('ngrx'));

// signalMethod:
const mySignalMethod = signalMethod<() => void>((callback) =>
  callback()
);
mySignalMethod(() => console.log('signals'));
```

AFTER:

```ts
// rxMethod:
const myRxMethod = rxMethod<{ callback: () => void }>(
  tap(({ callback }) => callback())
);

myRxMethod({ callback: () => console.log('ngrx') });

// signalMethod:
const mySignalMethod = signalMethod<{ callback: () => void }>(
  ({ callback }) => callback()
);
mySignalMethod({ callback: () => console.log('signals') });
```

### @ngrx/store

#### Removal of `SelectorWithProps` and `MemoizedSelectorWithProps`

The `SelectorWithProps` and `MemoizedSelectorWithProps` types have been removed. These were deprecated since v12 in favor of factory selectors. The following have been removed:

- `SelectorWithProps` type
- `MemoizedSelectorWithProps` interface
- `createSelector` overloads that accepted selectors with props
- `createSelectorFactory` overloads that returned `MemoizedSelectorWithProps`
- `Store.select()` and `select()` operator overloads that accepted props
- `Store.select()` and `select()` operator overloads that accepted string keys

A migration schematic will automatically remove `SelectorWithProps` and `MemoizedSelectorWithProps` imports from your code. To convert selectors with props to factory selectors, follow the pattern below.

BEFORE:

```ts
import { createSelector, SelectorWithProps } from '@ngrx/store';

const selectCustomer = createSelector(
  selectCustomers,
  (customers, props: { customerId: number }) => {
    return customers[props.customerId];
  }
);

// usage
this.store.select(selectCustomer, { customerId: 42 });
```

AFTER:

```ts
import { createSelector } from '@ngrx/store';

const selectCustomer = (customerId: number) =>
  createSelector(selectCustomers, (customers) => {
    return customers[customerId];
  });

// usage
this.store.select(selectCustomer(42));
```

#### Removal of string-key `select`

The `Store.select()` method and `select()` operator no longer accept string keys. Use selector functions instead.

BEFORE:

```ts
this.store.select('featureName');
this.store.pipe(select('featureName'));
```

AFTER:

```ts
this.store.select((state) => state.featureName);
this.store.pipe(select((state) => state.featureName));
```

### @ngrx/eslint-plugin

The lint rules that require type information have been moved to seperate predefined configurations.

| Configuration    | Configuration including type checked rules |
| ---------------- | ------------------------------------------ |
| `all`            | `allTypeChecked`                           |
| `componentStore` | N/A                                        |
| `effects`        | `effectsTypeChecked`                       |
| `operators`      | N/A                                        |
| `signals`        | `signalsTypeChecked`                       |
| `store`          | N/A                                        |
